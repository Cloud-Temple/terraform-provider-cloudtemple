---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "cloudtemple_compute_virtual_machine Resource - terraform-provider-cloudtemple"
subcategory: "Compute"
description: |-
  Provision a virtual machine. This allows instances to be created, updated, and deleted.
  Virtual machines can be created using three different methods:
  by creating a new instance with guest_operating_system_morefby cloning an existing virtual machine with clone_virtual_machine_idby deploying a content library item with content_library_id and content_library_item_id
  To manage this resource you will need the following roles:
    - compute_iaas_vmware_infrastructure_read
    - compute_iaas_vmware_infrastructure_write
    - compute_iaas_vmware_management
    - compute_iaas_vmware_read
    - compute_iaas_vmware_virtual_machine_power
    - backup_iaas_spp_read
    - backup_iaas_spp_write
    - activity_read
    - tag_read
    - tag_write
---

# cloudtemple_compute_virtual_machine (Resource)

Provision a virtual machine. This allows instances to be created, updated, and deleted.

 Virtual machines can be created using three different methods:

  - by creating a new instance with `guest_operating_system_moref`
  - by cloning an existing virtual machine with `clone_virtual_machine_id`
  - by deploying a content library item with `content_library_id` and `content_library_item_id`

To manage this resource you will need the following roles:
  - `compute_iaas_vmware_infrastructure_read`
  - `compute_iaas_vmware_infrastructure_write`
  - `compute_iaas_vmware_management`
  - `compute_iaas_vmware_read`
  - `compute_iaas_vmware_virtual_machine_power`
  - `backup_iaas_spp_read`
  - `backup_iaas_spp_write`
  - `activity_read`
  - `tag_read`
  - `tag_write`

## Example Usage

```terraform
data "cloudtemple_compute_virtual_datacenter" "dc" {
  name = "DC-EQX6"
}

data "cloudtemple_compute_host_cluster" "flo" {
  name = "clu002-ucs01_FLO"
}

data "cloudtemple_compute_datastore_cluster" "koukou" {
  name = "sdrs001-LIVE_KOUKOU"
}

data "cloudtemple_backup_sla_policy" "sla001-daily-par7s" {
  name = "sla001-daily-par7s"
}

data "cloudtemple_backup_sla_policy" "sla001-weekly-par7s" {
  name = "sla001-weekly-par7s"
}

# Deploying a new virtual machine with a given operating system
resource "cloudtemple_compute_virtual_machine" "scratch" {
  name = "from-scratch"

  memory                 = 8 * 1024 * 1024 * 1024
  cpu                    = 2
  num_cores_per_socket   = 1
  cpu_hot_add_enabled    = true
  cpu_hot_remove_enabled = true
  memory_hot_add_enabled = true

  datacenter_id                = data.cloudtemple_compute_virtual_datacenter.dc.id
  host_cluster_id              = data.cloudtemple_compute_host_cluster.flo.id
  datastore_cluster_id         = data.cloudtemple_compute_datastore_cluster.koukou.id
  guest_operating_system_moref = "amazonlinux2_64Guest"

  tags = {
    created_by = "Terraform"
  }

  backup_sla_policies = [
    data.cloudtemple_backup_sla_policy.sla001-daily-par7s.id,
    data.cloudtemple_backup_sla_policy.sla001-weekly-par7s.id,
  ]
}

# Clone an already existing virtual machine
resource "cloudtemple_compute_virtual_machine" "cloned" {
  name = "cloned"

  clone_virtual_machine_id = cloudtemple_compute_virtual_machine.scratch.id

  datacenter_id        = data.cloudtemple_compute_virtual_datacenter.dc.id
  host_cluster_id      = data.cloudtemple_compute_host_cluster.flo.id
  datastore_cluster_id = data.cloudtemple_compute_datastore_cluster.koukou.id

  tags = {
    created_by = "Terraform"
  }
}

# Deploy an item from the content library
data "cloudtemple_compute_content_library" "public" {
  name = "PUBLIC"
}

data "cloudtemple_compute_content_library_item" "centos" {
  content_library_id = data.cloudtemple_compute_content_library.public.id
  name               = "20211115132417_master_linux-centos-8"
}

data "cloudtemple_compute_datastore" "ds" {
  name = "ds001-bob-svc1-data4-eqx6"
}

data "cloudtemple_compute_network" "vlan" {
  name = "VLAN_201"
}

resource "cloudtemple_compute_virtual_machine" "content-library" {
  name = "from-content-library-item"

  content_library_id      = data.cloudtemple_compute_content_library.public.id
  content_library_item_id = data.cloudtemple_compute_content_library_item.centos.id

  datacenter_id        = data.cloudtemple_compute_virtual_datacenter.dc.id
  host_cluster_id      = data.cloudtemple_compute_host_cluster.flo.id
  datastore_cluster_id = data.cloudtemple_compute_datastore_cluster.koukou.id
  datastore_id         = data.cloudtemple_compute_datastore.ds.id

  os_disk {
    capacity = 25 * 1024 * 1024 * 1024
  }

  os_network_adapter {
    network_id = data.cloudtemple_compute_network.vlan.id
  }

  tags = {
    created_by = "Terraform"
  }
}

# Deploy an OVF from the content library and configure it with cloud-init
data "cloudtemple_compute_machine_manager" "vstack-001" {
  name = "vc-vstack-001-t0001"
}

data "cloudtemple_compute_virtual_datacenter" "TH3S" {
  name               = "DC-TH3S"
  machine_manager_id = data.cloudtemple_compute_machine_manager.vstack-001.id
}

data "cloudtemple_compute_host_cluster" "CLU001" {
  name               = "clu001-ucs12"
  machine_manager_id = data.cloudtemple_compute_machine_manager.vstack-001.id
}

data "cloudtemple_compute_datastore" "DS003" {
  name               = "ds003-t0001-r-stw1-data13-th3s"
  machine_manager_id = data.cloudtemple_compute_machine_manager.vstack-001.id
}

data "cloudtemple_backup_sla_policy" "sla001-daily-par7s" {
  name = "sla001-daily-par7s"
}

data "cloudtemple_backup_sla_policy" "sla001-weekly-par7s" {
  name = "sla001-weekly-par7s"
}

data "cloudtemple_compute_content_library" "local" {
  name = "local-vc-vstack-001-t0001"
}

data "cloudtemple_compute_content_library_item" "ubuntu-cloudimg" {
  content_library_id = data.cloudtemple_compute_content_library.local.id
  name               = "ubuntu-jammy-22.04-cloudimg"
}

resource "cloudtemple_compute_virtual_machine" "ubuntu-cloud-init" {
  name = "ubuntu-cloud-init"

  memory                 = 8 * 1024 * 1024 * 1024
  cpu                    = 2
  num_cores_per_socket   = 1
  cpu_hot_add_enabled    = true
  cpu_hot_remove_enabled = true
  memory_hot_add_enabled = true

  datacenter_id   = data.cloudtemple_compute_virtual_datacenter.TH3S.id
  host_cluster_id = data.cloudtemple_compute_host_cluster.CLU001.id
  datastore_id    = data.cloudtemple_compute_datastore.DS003.id

  content_library_id      = data.cloudtemple_compute_content_library.local.id
  content_library_item_id = data.cloudtemple_compute_content_library_item.ubuntu-cloudimg.id

  power_state = "on"

  backup_sla_policies = [
    data.cloudtemple_backup_sla_policy.sla001-daily-par7s.id,
    data.cloudtemple_backup_sla_policy.sla001-weekly-par7s.id,
  ]

  cloud_init = {
    network-config = filebase64("./cloud-init/network-config.yml")
    user-data      = filebase64("./cloud-init/user-data.yml")
  }
}

# Customize Guest OS using the customize block (deployed from an ubuntu OVF)
resource "cloudtemple_compute_virtual_machine" "bar" {
  name        = "pbt-customize-tf-04"
  power_state = "on"

  memory               = 8 * 1024 * 1024 * 1024
  cpu                  = 4
  num_cores_per_socket = 1

  datacenter_id        = data.cloudtemple_compute_virtual_datacenter.th3s.id
  host_cluster_id      = data.cloudtemple_compute_host_cluster.clu001.id
  datastore_cluster_id = data.cloudtemple_compute_datastore_cluster.sdrs001.id
  datastore_id         = data.cloudtemple_compute_datastore.ds001.id

  content_library_id      = data.cloudtemple_compute_content_library.cl001.id
  content_library_item_id = data.cloudtemple_compute_content_library_item.ubuntu.id

  backup_sla_policies = [
    data.cloudtemple_backup_sla_policy.nobackup.id
  ]

  os_network_adapter {
    network_id   = data.cloudtemple_compute_network.lan1.id
    auto_connect = true
  }

  customize {
    network_config {
      hostname = "Pimp-My-VM-updated"
      domain   = "cloud-temple.com"
      dns_server_list = [
        "8.8.8.8"
      ]
      adapters {
        ip_address  = "192.168.16.15"
        subnet_mask = "255.255.255.0"
        gateway     = "192.168.16.254"
      }
    }
  }
}

# Customize Guest OS using the customize block (Deployed from a Windows Server Clone)
resource "cloudtemple_compute_virtual_machine" "foo" {
  name        = "pbt-customize-tf-03"
  power_state = "on"

  memory               = 8 * 1024 * 1024 * 1024
  cpu                  = 4
  num_cores_per_socket = 1

  datacenter_id        = data.cloudtemple_compute_virtual_datacenter.th3s.id
  host_cluster_id      = data.cloudtemple_compute_host_cluster.clu001.id
  datastore_cluster_id = data.cloudtemple_compute_datastore_cluster.sdrs001.id
  datastore_id         = data.cloudtemple_compute_datastore.ds001.id

  clone_virtual_machine_id = data.cloudtemple_compute_virtual_machine.windows_server_vm.id

  backup_sla_policies = [
    data.cloudtemple_backup_sla_policy.nobackup.id
  ]

  os_network_adapter {
    network_id   = data.cloudtemple_compute_network.lan1.id
    auto_connect = true
  }

  customize {
    network_config {
      hostname = "Pimp-My-VM"
      domain   = "cloud-temple.com"
      dns_server_list = [
        "8.8.8.8"
      ]
      adapters {
        ip_address  = "192.168.16.12"
        subnet_mask = "255.255.255.0"
        gateway     = "192.168.16.254"
      }
    }
    windows_config {
      auto_logon       = true
      auto_logon_count = 3
      timezone         = 105
      password         = "azerty"
      workgroup        = "cloudtemple"
    }
  }
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `datacenter_id` (String) The datacenter to start the virtual machine in.
- `host_cluster_id` (String) The host cluster to start the virtual machine on.
- `name` (String)

### Optional

- `backup_sla_policies` (Set of String) The IDs of the SLA policies to assign to the virtual machine.
- `boot_options` (Block List, Max: 1) (see [below for nested schema](#nestedblock--boot_options))
- `clone_virtual_machine_id` (String) The ID of the virtual machine to clone. Conflict with `content_library_item_id`.
- `cloud_init` (Map of String) A set of cloud-init compatible key/value used to configure the virtual machine.
					
	List of cloud-init compatible keys :
	- `user-data` (This value should be base64 encoded)
	- `network-config` (This value should be base64 encoded)
	- `public-keys` Indicates that the instance should populate the default user's 'authorized_keys' with this value
	- `instance-id`
	- `password` If set, the default user's password will be set to this value to allow password based login.  The password will be good for only a single login.  If set to the string 'RANDOM' then a random password will be generated, and written to the console.
	- `hostname` Specifies the hostname for the appliance
	- `seedfrom`
	
	If you need more informations, please refer to the cloud-init documentation about the OVF datasource.

	NB : The cloud-init configuration is only triggered at virtual machine first startup and requires a cloud-init compatible OVF.
	For exemple, you can use this [Ubuntu Cloud Image](https://cloud-images.ubuntu.com/) and convert it to an OVF.
- `content_library_id` (String) The ID of the content library to clone from. Conflict with `clone_virtual_machine_id`.
- `content_library_item_id` (String) The ID of the content library item to clone. Conflict with `clone_virtual_machine_id`.
- `cpu` (Number) The number of CPUs to start the virtual machine with.
- `cpu_hot_add_enabled` (Boolean) Flag that indicate if hot add of CPU is enabled or not.
- `cpu_hot_remove_enabled` (Boolean) Flag that indicate if hot remove of CPU is enabled or not.
- `customize` (Block List, Max: 1) Customizes a virtual machine's guest operating system. (VMWare Tools has to be installed) (see [below for nested schema](#nestedblock--customize))
- `datastore_cluster_id` (String)
- `datastore_id` (String)
- `deploy_options` (Map of String)
- `disks_provisioning_type` (String) Overrides the provisioning type for the os_disks of an OVF. Possible values are: `dynamic`, `staticImmediate`, `staticDiffered`.
- `expose_hardware_virtualization` (Boolean) Enable nested hardware virtualization on the virtual machine, facilitating nested virtualization in the guest operating system (Default: false)
- `extra_config` (Map of String) Extra configuration parameters for the virtual machine. These are advanced VMware vSphere settings that can be used to configure specialized operating systems like CoreOS with Ignition.

Supported configurations include:
- Ignition for CoreOS: 'guestinfo.ignition.config.data', 'guestinfo.ignition.config.data.encoding', 'guestinfo.afterburn.initrd.network-kargs'
- Performance optimization: 'stealclock.enable'
- Disk configuration: 'disk.enableUUID'
- PCI Passthrough: 'pciPassthru.use64BitMMIO', 'pciPassthru.64bitMMioSizeGB'
- Guest info for cloud-init: 'guestinfo.userdata', 'guestinfo.userdata.encoding', 'guestinfo.metadata', 'guestinfo.metadata.encoding'

Note: Changes to extra_config may require a virtual machine restart to take effect.
- `guest_operating_system_moref` (String) The operating system to launch the virtual machine with.
- `host_id` (String) The host to start the virtual machine on.
- `memory` (Number) In bytes. The quantity of memory to start the virtual machine with.
- `memory_hot_add_enabled` (Boolean) Flag that indicate if hot add of memory is enabled or not.
- `memory_reservation` (Number) In bytes. Amount of resource that is guaranteed available to the virtual machine. Reserved resources are not wasted if they are not used. If the utilization is less than the reservation, the resources can be utilized by other running virtual machines.
- `num_cores_per_socket` (Number) Number of cores per socket.
- `os_disk` (Block List) OS disks created from content lib item deployment or virtual machine clone. (see [below for nested schema](#nestedblock--os_disk))
- `os_network_adapter` (Block List) OS network adapters created from content lib item deployment or virtual machine clone. (see [below for nested schema](#nestedblock--os_network_adapter))
- `power_state` (String) Whether to start the virtual machine.
- `tags` (Map of String) The tags to attach to the virtual machine.

### Read-Only

- `consolidation_needed` (Boolean) The most typical causes for VMs to shows ‘Virtual Machine disks consolidation is needed’ Alert:

-Snapshots cannot be deleted/consolidated after completing backups.

-There is not enough space on the Datastore to perform consolidation. VM disk/disks would be residing on the datastore which has less than 1 GB available space.

-Third-party backup application (Veeam, Unitrends, Dataprotect) has locked snapshot files, and failed to remove the snapshot after completing backups or failed to initiate backups. vCenter server and the ESXi host connectivity issues.

-When there are more than the VMware recommended number of snapshots, consolidation may fail. (VMware recommends only 32 as the maximum number of snapshots under best practices).

-When large snapshots are undergoing consolidation, VM may show unresponsive/frozen but the alert continues to show up.
- `cpu_usage` (Number)
- `datacenter_name` (String)
- `datastore_cluster_name` (String)
- `datastore_name` (String)
- `distributed_virtual_port_group_ids` (List of String)
- `hardware_version` (String)
- `host_cluster_name` (String)
- `id` (String) The ID of this resource.
- `machine_manager_id` (String)
- `machine_manager_name` (String)
- `machine_manager_type` (String)
- `memory_usage` (Number)
- `moref` (String) Virtual machine vSphere identifier.
- `operating_system_name` (String)
- `replication_config` (List of Object) (see [below for nested schema](#nestedatt--replication_config))
- `snapshoted` (Boolean)
- `spp_mode` (String) Clone mode creates copies of virtual machines for use cases that require permanent or long-running copies for data mining or duplication of a test environment in a fenced network. Virtual machines created in clone mode are also given unique names and identifiers to avoid conflicts within your production environment. With clone mode, you must be sensitive to resource consumption because clone mode creates permanent or long-term virtual machines.

Test mode creates temporary virtual machines for development or testing, snapshot verification, and disaster recovery verification on a scheduled, repeatable basis without affecting production environments. Test machines are kept running as long as needed to complete testing and verification and are then cleaned up. Through fenced networking, you can establish a safe environment to test your jobs without interfering with virtual machines used for production. Virtual machines that are created in test mode are also given unique names and identifiers to avoid conflicts within your production environment.
- `storage` (List of Object) (see [below for nested schema](#nestedatt--storage))
- `template` (Boolean) Flag that indicate whether the VM is a template or not.
- `tools` (String)
- `tools_version` (Number)
- `triggered_alarms` (List of Object) (see [below for nested schema](#nestedatt--triggered_alarms))

<a id="nestedblock--boot_options"></a>
### Nested Schema for `boot_options`

Optional:

- `boot_delay` (Number) Delay in milliseconds before starting the boot sequence. The boot delay specifies a time interval between virtual machine power on or restart and the beginning of the boot sequence.
- `boot_retry_delay` (Number) Delay in milliseconds before a boot retry. The boot retry delay specifies a time interval between virtual machine boot failure and the subsequent attempt to boot again. The virtual machine uses this value only if bootRetryEnabled is true.
- `boot_retry_enabled` (Boolean) If set to true, a virtual machine that fails to boot will try again after the bootRetryDelay time period has expired. When false, the virtual machine waits indefinitely for you to initiate boot retry.
- `efi_secure_boot_enabled` (Boolean) If set to true, the virtual machine's firmware will perform signature checks of any EFI images loaded during startup, and will refuse to start any images which do not pass those signature checks.
- `enter_bios_setup` (Boolean) If set to true, the virtual machine automatically enters BIOS setup the next time it boots. The virtual machine resets this flag to false so that subsequent boots proceed normally.
- `firmware` (String) Firmware type. (BIOS or EFI)


<a id="nestedblock--customize"></a>
### Nested Schema for `customize`

Required:

- `network_config` (Block List, Min: 1) A collection of global network settings. (see [below for nested schema](#nestedblock--customize--network_config))

Optional:

- `windows_config` (Block List, Max: 1) A set of Windows specific configurations. (see [below for nested schema](#nestedblock--customize--windows_config))

<a id="nestedblock--customize--network_config"></a>
### Nested Schema for `customize.network_config`

Required:

- `domain` (String) The fully qualified domain name.
- `hostname` (String) The network host name of the virtual machine.

Optional:

- `adapters` (Block List) The IP settings for the associated virtual network adapter. (see [below for nested schema](#nestedblock--customize--network_config--adapters))
- `dns_server_list` (Set of String) List of DNS servers
- `dns_suffix_list` (Set of String) List of name resolution suffixes for the virtual network adapter. This list applies to both Windows and Linux guest customization.

<a id="nestedblock--customize--network_config--adapters"></a>
### Nested Schema for `customize.network_config.adapters`

Required:

- `gateway` (String) Gateway address for this virtual network adapter.
- `ip_address` (String) Static IP Address for the virtual network adapter.
- `subnet_mask` (String) Subnet mask for this virtual network adapter.

Optional:

- `mac_address` (String) The MAC address of a network adapter being customized.



<a id="nestedblock--customize--windows_config"></a>
### Nested Schema for `customize.windows_config`

Required:

- `auto_logon` (Boolean) Flag to determine whether or not the machine automatically logs on as Administrator. See also the password property.
										If the AutoLogon flag is set, password must not be blank or the guest customization will fail.
- `auto_logon_count` (Number) If the AutoLogon flag is set, then the AutoLogonCount property specifies the number of times the machine should automatically log on as Administrator. Generally it should be 1, but if your setup requires a number of reboots, you may want to increase it.
- `timezone` (Number) The time zone index for the virtual machine. Numbers correspond to time zones listed at [ Microsoft Time Zone Index Values](https://learn.microsoft.com/en-us/previous-versions/windows/embedded/ms912391(v=winembedded.11)).

Optional:

- `domain` (Block List, Max: 1) The domain identification informations to provide to the Windows guest os. (see [below for nested schema](#nestedblock--customize--windows_config--domain))
- `password` (String, Sensitive) The new administrator password for the machine. To specify that the password should be set to blank (that is, no password), set the password value to NULL. Because of encryption, "" is NOT a valid value.
										If password is set to blank and autoLogon is set, the guest customization will fail.
- `workgroup` (String) The workgroup that the virtual machine should join. If this value is supplied, then the domain name and authentication fields must be empty.

<a id="nestedblock--customize--windows_config--domain"></a>
### Nested Schema for `customize.windows_config.domain`

Optional:

- `admin_password` (String, Sensitive) This is the password for the domain user account used for authentication if the virtual machine is joining a domain.
- `admin_username` (String) This is the domain user account used for authentication if the virtual machine is joining a domain. The user does not need to be a domain administrator, but the account must have the privileges required to add computers to the domain.
- `name` (String) The domain that the virtual machine should join. If this value is supplied, then admin_username and admin_password must also be supplied, and the workgroup name must be empty.




<a id="nestedblock--os_disk"></a>
### Nested Schema for `os_disk`

Optional:

- `capacity` (Number) The size of the disk in bytes. The size must be greater than or equal to the size of the virtual machine's operating system disk.
- `disk_mode` (String) Possible values are: persistent, independent_nonpersistent, independent_persistent.
Persistent: Changes are immediately and permanently written to the virtual disk
Independent non persistent: Changes to virtual disk are made to a redo log and discarded at power off. Not affected by snapshots
Independent persistent: Changes are immediately and permanently written to the virtual disk. Not affected by snapshots

Read-Only:

- `controller_bus_number` (Number) The bus number of the controller to which the virtual disk is attached.
- `datastore_id` (String) The ID of the datastore where the virtual disk is stored.
- `datastore_name` (String) The name of the datastore where the virtual disk is stored.
- `disk_path` (String) The path to the disk file in the datastore.
- `disk_unit_number` (Number) The disk unit number of the virtual disk.
- `editable` (Boolean) Whether the virtual disk is editable.
- `id` (String) The unique identifier of the virtual disk.
- `instant_access` (Boolean) Whether the disk is an instant access disk.
- `machine_manager_id` (String) The ID of the machine manager that manages the virtual disk.
- `name` (String) The name of the virtual disk.
- `native_id` (String) The native ID of the disk in the hypervisor.
- `provisioning_type` (String) The provisioning type of the virtual disk. Possible values are: `dynamic`, `staticImmediate`, `staticDiffered`.


<a id="nestedblock--os_network_adapter"></a>
### Nested Schema for `os_network_adapter`

Optional:

- `auto_connect` (Boolean) Whether the network adapter should be automatically connected when the virtual machine is powered on.
- `connected` (Boolean) Whether the network adapter is connected to the network.
- `mac_address` (String) The MAC address of the network adapter. If not specified, a random MAC address will be generated.
- `network_id` (String) The ID of the network to which the virtual machine is connected.

Read-Only:

- `id` (String) The unique identifier of the network adapter.
- `mac_type` (String) The type of MAC address assignment (e.g., MANUAL, GENERATED).
- `name` (String) The name of the network adapter.
- `type` (String) The type of the network adapter (e.g., VMXNET3, E1000).


<a id="nestedatt--replication_config"></a>
### Nested Schema for `replication_config`

Read-Only:

- `disk` (List of Object) (see [below for nested schema](#nestedobjatt--replication_config--disk))
- `encryption_destination` (Boolean)
- `generation` (Number)
- `net_compression_enabled` (Boolean)
- `net_encryption_enabled` (Boolean)
- `opp_updates_enabled` (Boolean)
- `paused` (Boolean)
- `quiesce_guest_enabled` (Boolean)
- `rpo` (Number)
- `vm_replication_id` (String)

<a id="nestedobjatt--replication_config--disk"></a>
### Nested Schema for `replication_config.disk`

Read-Only:

- `disk_replication_id` (String)
- `key` (Number)



<a id="nestedatt--storage"></a>
### Nested Schema for `storage`

Read-Only:

- `committed` (Number)
- `uncommitted` (Number)


<a id="nestedatt--triggered_alarms"></a>
### Nested Schema for `triggered_alarms`

Read-Only:

- `id` (String)
- `status` (String)

## Import

Import is supported using the following syntax:

```shell
$ terraform import cloudtemple_compute_virtual_machine.foo de2b8b80-8b90-414a-bc33-e12f61a4c05c
```
