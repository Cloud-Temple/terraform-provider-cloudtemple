---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "cloudtemple_compute_virtual_machine Resource - terraform-provider-cloudtemple"
subcategory: "Compute"
description: |-
  Provision a virtual machine. This allows instances to be created, updated, and deleted.
  Virtual machines can be created using three different methods:
  by creating a new instance with guest_operating_system_morefby cloning an existing virtual machine with clone_virtual_machine_idby deploying a content library item with content_library_id and content_library_item_id
  To manage this resource you will need the following roles:
    - compute_write
    - compute_read
    - activity_read
    - tag_read
    - tag_write
---

# cloudtemple_compute_virtual_machine (Resource)

Provision a virtual machine. This allows instances to be created, updated, and deleted.

Virtual machines can be created using three different methods:

  - by creating a new instance with `guest_operating_system_moref`
  - by cloning an existing virtual machine with `clone_virtual_machine_id`
  - by deploying a content library item with `content_library_id` and `content_library_item_id`

To manage this resource you will need the following roles:
  - `compute_write`
  - `compute_read`
  - `activity_read`
  - `tag_read`
  - `tag_write`

## Example Usage

```terraform
data "cloudtemple_compute_virtual_datacenter" "dc" {
  name = "DC-EQX6"
}

data "cloudtemple_compute_host_cluster" "flo" {
  name = "clu002-ucs01_FLO"
}

data "cloudtemple_compute_datastore_cluster" "koukou" {
  name = "sdrs001-LIVE_KOUKOU"
}

data "cloudtemple_backup_sla_policy" "sla001-daily-par7s" {
  name = "sla001-daily-par7s"
}

data "cloudtemple_backup_sla_policy" "sla001-weekly-par7s" {
  name = "sla001-weekly-par7s"
}

# Deploying a new virtual machine with a given operating system
resource "cloudtemple_compute_virtual_machine" "scratch" {
  name = "from-scratch"

  memory                 = 8 * 1024 * 1024 * 1024
  cpu                    = 2
  num_cores_per_socket   = 1
  cpu_hot_add_enabled    = true
  cpu_hot_remove_enabled = true
  memory_hot_add_enabled = true

  datacenter_id                = data.cloudtemple_compute_virtual_datacenter.dc.id
  host_cluster_id              = data.cloudtemple_compute_host_cluster.flo.id
  datastore_cluster_id         = data.cloudtemple_compute_datastore_cluster.koukou.id
  guest_operating_system_moref = "amazonlinux2_64Guest"

  tags = {
    created_by = "Terraform"
  }

  backup_sla_policies = [
    data.cloudtemple_backup_sla_policy.sla001-daily-par7s.id,
    data.cloudtemple_backup_sla_policy.sla001-weekly-par7s.id,
  ]
}

# Clone an already existing virtual machine
resource "cloudtemple_compute_virtual_machine" "cloned" {
  name = "cloned"

  clone_virtual_machine_id = cloudtemple_compute_virtual_machine.scratch.id

  datacenter_id        = data.cloudtemple_compute_virtual_datacenter.dc.id
  host_cluster_id      = data.cloudtemple_compute_host_cluster.flo.id
  datastore_cluster_id = data.cloudtemple_compute_datastore_cluster.koukou.id

  tags = {
    created_by = "Terraform"
  }
}

# Deploy an item from the content library
data "cloudtemple_compute_content_library" "public" {
  name = "PUBLIC"
}

data "cloudtemple_compute_content_library_item" "centos" {
  content_library_id = data.cloudtemple_compute_content_library.public.id
  name               = "20211115132417_master_linux-centos-8"
}

data "cloudtemple_compute_datastore" "ds" {
  name = "ds001-bob-svc1-data4-eqx6"
}

data "cloudtemple_compute_network" "vlan" {
  name = "VLAN_201"
}

resource "cloudtemple_compute_virtual_machine" "content-library" {
  name = "from-content-library-item"

  content_library_id      = data.cloudtemple_compute_content_library.public.id
  content_library_item_id = data.cloudtemple_compute_content_library_item.centos.id

  datacenter_id        = data.cloudtemple_compute_virtual_datacenter.dc.id
  host_cluster_id      = data.cloudtemple_compute_host_cluster.flo.id
  datastore_cluster_id = data.cloudtemple_compute_datastore_cluster.koukou.id
  datastore_id         = data.cloudtemple_compute_datastore.ds.id

  os_disk {
    capacity = 25 * 1024 * 1024 * 1024
  }

  os_network_adapter {
    network_id = data.cloudtemple_compute_network.vlan.id
  }

  tags = {
    created_by = "Terraform"
  }
}

# Deploy an OVF from the content library and configure it with cloud-init
data "cloudtemple_compute_machine_manager" "vstack-001" {
  name = "vc-vstack-001-t0001"
}

data "cloudtemple_compute_virtual_datacenter" "TH3S" {
  name               = "DC-TH3S"
  machine_manager_id = data.cloudtemple_compute_machine_manager.vstack-001.id
}

data "cloudtemple_compute_host_cluster" "CLU001" {
  name               = "clu001-ucs12"
  machine_manager_id = data.cloudtemple_compute_machine_manager.vstack-001.id
}

data "cloudtemple_compute_datastore" "DS003" {
  name               = "ds003-t0001-r-stw1-data13-th3s"
  machine_manager_id = data.cloudtemple_compute_machine_manager.vstack-001.id
}

data "cloudtemple_backup_sla_policy" "sla001-daily-par7s" {
  name = "sla001-daily-par7s"
}

data "cloudtemple_backup_sla_policy" "sla001-weekly-par7s" {
  name = "sla001-weekly-par7s"
}

data "cloudtemple_compute_content_library" "local" {
  name = "local-vc-vstack-001-t0001"
}

data "cloudtemple_compute_content_library_item" "ubuntu-cloudimg" {
  content_library_id = data.cloudtemple_compute_content_library.local.id
  name               = "ubuntu-jammy-22.04-cloudimg"
}

resource "cloudtemple_compute_virtual_machine" "ubuntu-cloud-init" {
  name = "ubuntu-cloud-init"

  memory                 = 8 * 1024 * 1024 * 1024
  cpu                    = 2
  num_cores_per_socket   = 1
  cpu_hot_add_enabled    = true
  cpu_hot_remove_enabled = true
  memory_hot_add_enabled = true

  datacenter_id   = data.cloudtemple_compute_virtual_datacenter.TH3S.id
  host_cluster_id = data.cloudtemple_compute_host_cluster.CLU001.id
  datastore_id    = data.cloudtemple_compute_datastore.DS003.id

  content_library_id      = data.cloudtemple_compute_content_library.local.id
  content_library_item_id = data.cloudtemple_compute_content_library_item.ubuntu-cloudimg.id

  power_state = "on"

  backup_sla_policies = [
    data.cloudtemple_backup_sla_policy.sla001-daily-par7s.id,
    data.cloudtemple_backup_sla_policy.sla001-weekly-par7s.id,
  ]

  cloud_init = {
    network-config = filebase64("./cloud-init/network-config.yml")
    user-data      = filebase64("./cloud-init/user-data.yml")
  }
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `datacenter_id` (String) The datacenter to start the virtual machine in.
- `host_cluster_id` (String) The host cluster to start the virtual machine on.
- `name` (String)

### Optional

- `backup_sla_policies` (Set of String) The IDs of the SLA policies to assign to the virtual machine.
- `clone_virtual_machine_id` (String) The ID of the virtual machine to clone. Conflict with `content_library_item_id`.
- `cloud_init` (Map of String) A set of cloud-init compatible key/value used to configure the virtual machine.
					
	List of cloud-init compatible keys :
	- `user-data` (This value should be base64 encoded)
	- `network-config` (This value should be base64 encoded)
	- `public-keys` Indicates that the instance should populate the default user's 'authorized_keys' with this value
	- `instance-id`
	- `password` If set, the default user's password will be set to this value to allow password based login.  The password will be good for only a single login.  If set to the string 'RANDOM' then a random password will be generated, and written to the console.
	- `hostname` Specifies the hostname for the appliance
	- `seedfrom`
	
	If you need more informations, please refer to the cloud-init documentation about the OVF datasource.

	NB : The cloud-init configuration is only triggered at virtual machine first startup and requires a cloud-init compatible OVF.
	For exemple, you can use this [Ubuntu Cloud Image](https://cloud-images.ubuntu.com/) and convert it to an OVF.
- `content_library_id` (String) The ID of the content library to clone from. Conflict with `clone_virtual_machine_id`.
- `content_library_item_id` (String) The ID of the content library item to clone. Conflict with `clone_virtual_machine_id`.
- `cpu` (Number) The number of CPUs to start the virtual machine with.
- `cpu_hot_add_enabled` (Boolean)
- `cpu_hot_remove_enabled` (Boolean)
- `datastore_cluster_id` (String)
- `datastore_id` (String)
- `deploy_options` (Map of String)
- `guest_operating_system_moref` (String) The operating system to launch the virtual machine with.
- `host_id` (String) The host to start the virtual machine on.
- `memory` (Number) The quantity of memory to start the virtual machine with.
- `memory_hot_add_enabled` (Boolean)
- `num_cores_per_socket` (Number)
- `os_disk` (Block List) OS disks created from content lib item deployment or virtual machine clone. (see [below for nested schema](#nestedblock--os_disk))
- `os_network_adapter` (Block List) OS network adapters created from content lib item deployment or virtual machine clone. (see [below for nested schema](#nestedblock--os_network_adapter))
- `power_state` (String) Whether to start the virtual machine.
- `tags` (Map of String) The tags to attach to the virtual machine.

### Read-Only

- `boot_options` (List of Object) (see [below for nested schema](#nestedatt--boot_options))
- `consolidation_needed` (Boolean)
- `cpu_usage` (Number)
- `datastore_name` (String)
- `distributed_virtual_port_group_ids` (List of String)
- `extra_config` (List of Object) (see [below for nested schema](#nestedatt--extra_config))
- `hardware_version` (String)
- `id` (String) The ID of this resource.
- `machine_manager_id` (String)
- `machine_manager_name` (String)
- `machine_manager_type` (String)
- `memory_usage` (Number)
- `moref` (String)
- `operating_system_name` (String)
- `replication_config` (List of Object) (see [below for nested schema](#nestedatt--replication_config))
- `snapshoted` (Boolean)
- `spp_mode` (String)
- `storage` (List of Object) (see [below for nested schema](#nestedatt--storage))
- `template` (Boolean)
- `tools` (String)
- `tools_version` (Number)
- `triggered_alarms` (List of Object) (see [below for nested schema](#nestedatt--triggered_alarms))

<a id="nestedblock--os_disk"></a>
### Nested Schema for `os_disk`

Optional:

- `capacity` (Number)
- `disk_mode` (String)

Read-Only:

- `controller_bus_number` (Number)
- `datastore_id` (String)
- `datastore_name` (String)
- `disk_path` (String)
- `disk_unit_number` (Number)
- `editable` (Boolean)
- `id` (String) The ID of this resource.
- `instant_access` (Boolean)
- `machine_manager_id` (String)
- `name` (String)
- `native_id` (String)
- `provisioning_type` (String)


<a id="nestedblock--os_network_adapter"></a>
### Nested Schema for `os_network_adapter`

Optional:

- `auto_connect` (Boolean)
- `connected` (Boolean)
- `mac_address` (String)
- `mac_type` (String)
- `network_id` (String)

Read-Only:

- `id` (String) The ID of this resource.
- `name` (String)
- `type` (String)


<a id="nestedatt--boot_options"></a>
### Nested Schema for `boot_options`

Read-Only:

- `boot_delay` (Number)
- `boot_retry_delay` (Number)
- `boot_retry_enabled` (Boolean)
- `enter_bios_setup` (Boolean)
- `firmware` (String)


<a id="nestedatt--extra_config"></a>
### Nested Schema for `extra_config`

Read-Only:

- `key` (String)
- `value` (String)


<a id="nestedatt--replication_config"></a>
### Nested Schema for `replication_config`

Read-Only:

- `disk` (List of Object) (see [below for nested schema](#nestedobjatt--replication_config--disk))
- `encryption_destination` (Boolean)
- `generation` (Number)
- `net_compression_enabled` (Boolean)
- `net_encryption_enabled` (Boolean)
- `opp_updates_enabled` (Boolean)
- `paused` (Boolean)
- `quiesce_guest_enabled` (Boolean)
- `rpo` (Number)
- `vm_replication_id` (String)

<a id="nestedobjatt--replication_config--disk"></a>
### Nested Schema for `replication_config.disk`

Read-Only:

- `disk_replication_id` (String)
- `key` (Number)



<a id="nestedatt--storage"></a>
### Nested Schema for `storage`

Read-Only:

- `committed` (Number)
- `uncommitted` (Number)


<a id="nestedatt--triggered_alarms"></a>
### Nested Schema for `triggered_alarms`

Read-Only:

- `id` (String)
- `status` (String)

## Import

Import is supported using the following syntax:

```shell
$ terraform import cloudtemple_compute_virtual_machine.foo de2b8b80-8b90-414a-bc33-e12f61a4c05c
```
